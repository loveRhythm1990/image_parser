# 技能选择功能使用指南

## 功能概述

每个英雄的技能按钮现在可以选择不同的召唤师技能，支持以下 11 种技能：

1. **闪现**（默认）
2. **惩戒**
3. **终结**
4. **狂暴**
5. **疾跑**
6. **治疗**
7. **干扰**
8. **晕眩**
9. **净化**
10. **弱化**
11. **传送**

---

## 使用方法

### 1. 启动技能倒计时

**点击技能按钮**（显示为"闪现"或其他技能名称），直接启动当前技能的倒计时。

- 倒计时从 10 开始递减到 0
- 每次点击都会重新启动倒计时

### 2. 选择技能

**长按技能按钮**，会弹出技能选择悬浮面板。

- 悬浮面板显示所有 11 种可选技能
- **支持上下滚动查看所有技能**（最大高度 300dp）
- 当前选中的技能会高亮显示（绿色背景）
- 点击任意技能即可选择
- 选择后会自动更新按钮显示并启动倒计时
- 点击"取消"按钮或面板外部区域可关闭面板

### 3. 大招按钮

**点击大招按钮**，启动大招的倒计时（行为未改变）。

---

## 按钮布局

每个英雄的面板布局如下：

```
┌─────────────────┐
│     英雄 X      │
├────────┬────────┤
│  大招  │  闪现  │  ← 技能名称（可点击选择）
├────────┼────────┤
│   10   │   10   │  ← 倒计时
└────────┴────────┘
```

---

## 操作示例

### 示例 1：快速启动英雄 1 的技能倒计时

1. 点击"英雄 1"下方的技能按钮（如"闪现"）
2. 倒计时立即从 10 开始

### 示例 2：更换英雄 2 的技能为"惩戒"

1. 长按"英雄 2"下方的"闪现"按钮
2. 在弹出的对话框中选择"惩戒"
3. 按钮文字自动变为"惩戒"
4. 倒计时自动从 10 开始

---

## 技术实现

### 数据结构

```kotlin
// 技能列表
private val skillsList = listOf(
    "闪现", "惩戒", "终结", "狂暴", "疾跑", 
    "治疗", "干扰", "晕眩", "净化", "弱化", "传送"
)

// 每个英雄当前选择的技能
private val selectedSkills = mutableMapOf(
    R.id.hero1SkillButton to "闪现",
    R.id.hero2SkillButton to "闪现",
    ...
)
```

### 交互逻辑

- **点击技能按钮** → 直接启动倒计时
- **长按技能按钮** → 显示悬浮选择面板
- **点击大招按钮** → 启动大招倒计时

### 悬浮面板实现

- 使用 `WindowManager` 添加自定义的 `LinearLayout` 作为选择面板
- 面板类型为 `TYPE_APPLICATION_OVERLAY`，可在其他应用上层显示
- 使用 `FLAG_NOT_TOUCH_MODAL` 允许点击外部区域
- **使用 `ScrollView` 包裹技能列表，支持滚动**
- 限制面板最大高度为 300dp，确保在屏幕上完整显示
- 当前选中技能用绿色背景高亮显示
- 支持点击外部区域关闭面板

### 降级方案

如果显示悬浮面板失败，会自动降级为循环切换技能模式（每次点击切换到下一个技能）。

---

## 注意事项

1. **默认技能**：所有英雄初始技能默认为"闪现"
2. **技能独立**：每个英雄的技能选择是独立的
3. **倒计时重置**：选择新技能后会自动重新从 10 开始倒计时
4. **持久化**：当前版本技能选择不会被保存，重启应用后会重置为默认

---

## 未来改进

- [ ] 添加技能图标显示
- [ ] 保存技能选择到本地存储
- [ ] 支持自定义技能 CD 时间
- [ ] 根据实际游戏数据动态更新 CD 时间

