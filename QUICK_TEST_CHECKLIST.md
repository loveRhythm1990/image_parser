# ✅ 快速测试清单

## 🚀 重新构建和安装

### 第 1 步：清理并构建
```
Android Studio:
1. Build > Clean Project
2. Build > Build APK(s)
```

### 第 2 步：卸载旧版本
```bash
# 方法 1：在模拟器中长按应用图标 > 卸载

# 方法 2：使用命令（在 Android Studio Terminal）
adb uninstall com.example.floatingscreenshot
```

### 第 3 步：安装新版本
```
将 app-debug.apk 拖入模拟器
位置：app/build/outputs/apk/debug/app-debug.apk
```

---

## 📱 测试步骤

### 🔍 开启 Logcat（必须！）

在 Android Studio 底部点击 **`Logcat`** 标签

**过滤设置：**
- 在搜索框输入：`MainActivity`
- 或者输入：`FloatingWindow`

---

### ✅ 测试 1：启动应用

**操作：**
打开"悬浮截屏"应用

**预期结果：**
- ✅ 应用正常打开，没有闪退
- ✅ 看到主界面，有两个按钮
- ✅ 状态文字显示权限状态

**如果闪退：**
❌ 查看 Logcat 中的 `AndroidRuntime` 错误信息

---

### ✅ 测试 2：授权悬浮窗权限

**操作：**
1. 点击"授权并启动"按钮
2. 如果弹出对话框，点击"前往设置"
3. 在设置中开启"在其他应用上层显示"权限
4. 返回应用

**预期 Logcat 日志：**
```
D/MainActivity: checkPermissionsAndStart 被调用
D/MainActivity: 没有悬浮窗权限，弹出对话框
（返回后再次点击）
D/MainActivity: 已有悬浮窗权限，启动服务
D/MainActivity: 准备启动悬浮窗服务
D/MainActivity: 调用了 startForegroundService
```

**预期 Toast：**
```
"悬浮窗服务已启动，请查看屏幕左上方"
```

---

### ✅ 测试 3：查找悬浮按钮

**操作：**
在模拟器屏幕上寻找悬浮按钮

**位置：**
- 📍 屏幕**左上角**偏右一点
- 📍 距离顶部约 100 像素
- 📍 距离左边约 100 像素

**外观：**
- 🟣 半透明圆形按钮
- 📱 内有截屏图标
- 💫 稍微透明（alpha = 0.8）

**预期 Logcat 日志：**
```
D/FloatingWindow: Service onCreate 被调用
D/FloatingWindow: Service onStartCommand 被调用
D/FloatingWindow: 悬浮窗已添加到屏幕
```

**预期 Toast：**
```
"悬浮按钮已显示"
```

**如果看不到按钮：**
1. ❌ 检查 Logcat 是否有"悬浮窗已添加到屏幕"
2. ❌ 如果没有，查看是否有错误日志
3. ❌ 尝试滑动屏幕，可能按钮在其他位置
4. ❌ 检查权限是否真的授予了

---

### ✅ 测试 4：拖动悬浮按钮

**操作：**
长按悬浮按钮并拖动到其他位置

**预期结果：**
- ✅ 按钮可以跟随手指移动
- ✅ 松开后固定在新位置
- ✅ 不会触发点击事件

---

### ✅ 测试 5：点击悬浮按钮截屏

**操作：**
轻点悬浮按钮（不要拖动）

**预期 Logcat 日志：**
```
D/FloatingWindow: 悬浮按钮被点击
```

**预期 Toast：**
```
"准备截屏..."
```

**预期行为：**
- ✅ 弹出系统权限对话框
- ✅ 标题："开始投射屏幕"
- ✅ 内容："悬浮截屏将开始截取您的屏幕上显示的所有内容"
- ✅ 按钮：[立即开始] [取消]

---

### ✅ 测试 6：授权截屏权限

**操作：**
点击"立即开始"按钮

**预期结果：**
- ✅ 对话框消失
- ✅ 等待约 0.5 秒
- ✅ 自动截屏
- ✅ 显示 Toast："截屏已保存: /path/to/file"

**预期截屏保存位置：**
```
/storage/emulated/0/Android/data/com.example.floatingscreenshot/files/Pictures/Screenshot_yyyyMMdd_HHmmss.png
```

---

### ✅ 测试 7：再次截屏（无需授权）

**操作：**
再次点击悬浮按钮

**预期结果：**
- ✅ 不再弹出权限对话框
- ✅ 直接截屏
- ✅ 显示 Toast："截屏已保存"

---

### ✅ 测试 8：跨应用截屏

**操作：**
1. 打开其他应用（如浏览器、设置）
2. 悬浮按钮仍然显示
3. 点击悬浮按钮

**预期结果：**
- ✅ 悬浮按钮始终显示在最上层
- ✅ 可以在任何应用上点击
- ✅ 能截取当前屏幕内容

---

### ✅ 测试 9：停止悬浮窗

**操作：**
1. 返回"悬浮截屏"应用
2. 点击"停止悬浮窗"按钮

**预期结果：**
- ✅ 悬浮按钮消失
- ✅ 显示 Toast："悬浮窗已停止"

---

## ❌ 常见问题排查

### 问题 1：应用闪退

**排查步骤：**
1. 打开 Logcat
2. 搜索 `AndroidRuntime`
3. 查看堆栈跟踪信息
4. 记录错误信息

**常见原因：**
- 缺少权限
- 布局文件错误
- Service 配置错误

---

### 问题 2：看不到悬浮按钮

**排查步骤：**
1. 检查 Logcat 中是否有："悬浮窗已添加到屏幕"
2. 如果有，在屏幕左上角仔细寻找
3. 如果没有，查看是否有错误日志
4. 手动检查权限设置

**快速验证权限：**
```
设置 > 应用 > 悬浮截屏 > 
找到 "Display over other apps" > 确认已开启
```

---

### 问题 3：点击悬浮按钮没反应

**排查步骤：**
1. 检查 Logcat 是否有："悬浮按钮被点击"
2. 如果没有，尝试：
   - 点击按钮中心位置
   - 不要拖动，轻点后立即松开

**如果有日志但没弹窗：**
- 检查截屏权限对话框是否被其他窗口遮挡
- 尝试最小化其他窗口

---

### 问题 4：截屏失败

**排查步骤：**
1. 检查是否点击了"立即开始"
2. 查看 Logcat 中的错误信息
3. 检查存储权限

**验证截屏文件：**
```bash
# 在 Android Studio Terminal 中
adb shell ls -la /sdcard/Android/data/com.example.floatingscreenshot/files/Pictures/
```

---

## 📋 完整成功标准

如果所有测试通过，您应该能够：

- ✅ 应用正常启动，不闪退
- ✅ 成功授权悬浮窗权限
- ✅ 看到半透明悬浮按钮
- ✅ 可以拖动悬浮按钮
- ✅ 点击悬浮按钮能触发截屏
- ✅ 首次弹出权限对话框
- ✅ 授权后成功截屏
- ✅ 后续截屏无需再次授权
- ✅ 可以在其他应用上使用
- ✅ 可以停止悬浮窗服务

---

## 🆘 需要帮助？

如果测试失败，请提供：

1. **Logcat 完整日志**
   - 包含 MainActivity 和 FloatingWindow 的所有日志
   - 特别是错误信息

2. **失败的测试步骤编号**
   - 例如："测试 3 失败，看不到悬浮按钮"

3. **看到的实际现象**
   - 截图
   - 错误提示
   - Toast 内容

祝测试顺利！🎉

